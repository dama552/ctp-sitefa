{% extends 'inicio/inicio.html' %}

{% block section %}

    <div class="header">
        <h1><i class="fas fa-edit header-icon"></i> Registrar Asistencia</h1>
    </div>

    <!-- Muestra errores generales del formulario -->
    {% if form.non_field_errors %}
        <div class="alert alert-danger mt-3">
            {{ form.non_field_errors }}
        </div>
    {% endif %}

    <!-- El formulario ahora usa method="post" y el token de seguridad CSRF -->
    <form method="post" class="mt-4">
        {% csrf_token %}

        <!-- Campo Estudiante (dinámico) -->
        <div class="mb-3">
            {{ form.estudiante.label_tag }}
            {{ form.estudiante }}
            <!-- Muestra errores específicos de este campo -->
            {% if form.estudiante.errors %}
                <div class="form-text text-danger">
                    {{ form.estudiante.errors|join:", " }}
                </div>
            {% endif %}
        </div>

        <!-- Campo Materia (dinámico) -->
        <div class="mb-3">
            {{ form.materia.label_tag }}
            {{ form.materia }}
            {% if form.materia.errors %}
                <div class="form-text text-danger">
                    {{ form.materia.errors|join:", " }}
                </div>
            {% endif %}
        </div>

        <!-- Switch de Asistencia -->
        <div class="mb-3 form-check form-switch">
            <input class="form-check-input" type="checkbox" id="{{ form.presente.id_for_label }}"
                   name="{{ form.presente.name }}" {% if form.presente.value %}checked{% endif %}>
            <label class="form-check-label" for="{{ form.presente.id_for_label }}"><strong>Presente</strong></label>
        </div>

        <!-- Campo Justificación (dinámico y condicional) -->
        <div id="justificacion-container" class="mb-3 {% if form.presente.value %}d-none{% endif %}">
            {{ form.justificacion.label_tag }}
            {{ form.justificacion }}
            {% if form.justificacion.errors %}
                <div class="form-text text-danger">
                    {{ form.justificacion.errors|join:", " }}
                </div>
            {% endif %}
        </div>

        <div class="d-flex justify-content-end gap-2">
            <a href="{% url 'asistencia:asistencia_leer' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver a la lista
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Guardar
            </button>
        </div>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const presenteCheckbox = document.getElementById('{{ form.presente.id_for_label }}');
            const justificacionContainer = document.getElementById('justificacion-container');

            function toggleJustificacion() {
                if (presenteCheckbox.checked) {
                    justificacionContainer.classList.add('d-none');
                } else {
                    justificacionContainer.classList.remove('d-none');
                }
            }

            toggleJustificacion();
            presenteCheckbox.addEventListener('change', toggleJustificacion);
        });
    </script>

{% endblock section %}