{% extends 'inicio/inicio.html' %}

{% block section %}
<div class="form-container">
    <!-- BARRA SUPERIOR: Título y Botón Volver -->
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-edit"></i> Registrar Asistencia</h1>
        <a href="{% url 'asistencia:asistencia_leer' %}">
            <button class="btn btn-volver" type="button">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
        </a>
    </div>
    <hr>

    <!-- FORMULARIO -->
    <form method="post" class="styled-form">
        {% csrf_token %}

        <!-- Muestra errores generales del formulario -->
        {% if form.non_field_errors %}
            <div class="alert alert-danger mt-3">
                {{ form.non_field_errors }}
            </div>
        {% endif %}

        <!-- Campo Estudiante (dinámico) -->
        <div class="mb-3">
            <label for="{{ form.estudiante.id_for_label }}" class="form-label">Estudiante:</label>
            {{ form.estudiante }}
            {% if form.estudiante.errors %}
                <div class="form-text text-danger">
                    {{ form.estudiante.errors|join:", " }}
                </div>
            {% endif %}
        </div>

        <!-- Campo Materia (dinámico) -->
        <div class="mb-3">
            <label for="{{ form.materia.id_for_label }}" class="form-label">Materia:</label>
            {{ form.materia }}
            {% if form.materia.errors %}
                <div class="form-text text-danger">
                    {{ form.materia.errors|join:", " }}
                </div>
            {% endif %}
        </div>

        <!-- Switch de Asistencia -->
        <div class="mb-3 form-check form-switch">
            <input class="form-check-input" type="checkbox" id="{{ form.presente.id_for_label }}"
                   name="{{ form.presente.name }}" {% if form.presente.value %}checked{% endif %}>
            <label class="form-check-label" for="{{ form.presente.id_for_label }}"><strong>Presente</strong></label>
        </div>

        <!-- Campo Justificación (dinámico y condicional) -->
        <div id="justificacion-container" class="mb-3 {% if form.presente.value %}d-none{% endif %}">
            <label for="{{ form.justificacion.id_for_label }}" class="form-label">Justificación:</label>
            {{ form.justificacion }}
            {% if form.justificacion.errors %}
                <div class="form-text text-danger">
                    {{ form.justificacion.errors|join:", " }}
                </div>
            {% endif %}
        </div>

        <!-- BOTÓN GUARDAR (alineado a la derecha) -->
        <div class="form-actions">
            <button type="submit" class="btn btn-guardar">
               <i class="fas fa-save"></i> Guardar
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const presenteCheckbox = document.getElementById('{{ form.presente.id_for_label }}');
        const justificacionContainer = document.getElementById('justificacion-container');

        function toggleJustificacion() {
            if (presenteCheckbox.checked) {
                justificacionContainer.classList.add('d-none');
            } else {
                justificacionContainer.classList.remove('d-none');
            }
        }

        toggleJustificacion();
        presenteCheckbox.addEventListener('change', toggleJustificacion);
    });
</script>
{% endblock section %}