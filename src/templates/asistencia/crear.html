{% extends 'inicio/inicio.html' %}

{% block section %}
<div class="form-container">
    <!-- BARRA SUPERIOR: Título y Botón Volver -->
    <div class="d-flex justify-content-between align-items-center">
        <h1>Crear Asistencia</h1>
        <a href="{% url 'asistencia:asistencia_leer' %}">
            <button class="btn btn-volver" type="button">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
        </a>
    </div>
    <hr>

    <!-- FORMULARIO -->
    <form method="post" class="styled-form">
        {% csrf_token %}

        <!-- Muestra errores generales del formulario -->
        {% if form.non_field_errors %}
            <div class="alert alert-danger mt-3">
                {{ form.non_field_errors }}
            </div>
        {% endif %}

        <!-- Campo Estudiante con DATALIST -->
        <div class="mb-3">
            <label for="id_estudiante" class="form-label">Estudiantes:</label>
            <select name="estudiante" id="id_estudiante" class="form-select" required>
                <option value="">---------</option>
                {% for estudiante in estudiantes %}
                    <option value="{{ estudiante.id }}">
                        {{estudiante.nombre}}
                    </option>
                {% endfor %}
            </select>
        </div>
            
        <!-- Campo Materia con DATALIST -->
        <div class="mb-3">
            <label for="id_materia" class="form-label">Materias:</label>
            <select name="materia" id="id_materia" class="form-select" required>
                <option value="">---------</option>
                {% for materia in materias %}
                    <option value="{{ prof.id }}" {% if selected_profesorado == prof.id %}selected{% endif %}>
                        {{materia.nombre}}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Switch de Asistencia -->
        <div class="mb-3 form-check form-switch">
            <input class="form-check-input" type="checkbox" id="id_presente" name="presente" checked>
            <label class="form-check-label" for="id_presente"><strong>Presente</strong></label>
        </div>

        <!-- Campo Justificación (dinámico y condicional) -->
        <div id="justificacion-container" class="mb-3 d-none">
            <label for="id_justificacion" class="form-label">Justificación:</label>
            <textarea name="justificacion" cols="40" rows="3" class="form-control" id="id_justificacion"></textarea>
        </div>

        <!-- BOTÓN GUARDAR (alineado a la derecha) -->
        <div class="form-actions">
            <button type="submit" class="btn btn-guardar">
               <i class="fas fa-save"></i> Guardar
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const presenteCheckbox = document.getElementById('id_presente');
        const justificacionContainer = document.getElementById('justificacion-container');

        function toggleJustificacion() {
            if (presenteCheckbox.checked) {
                justificacionContainer.classList.add('d-none');
            } else {
                justificacionContainer.classList.remove('d-none');
            }
        }

        toggleJustificacion();
        presenteCheckbox.addEventListener('change', toggleJustificacion);
    });
</script>
{% endblock section %}