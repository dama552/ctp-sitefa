{% extends 'inicio/inicio.html' %}

{% block section %}

<div class="header">
    <h1><i class="fas fa-edit header-icon"></i> Actualizar Asistencia</h1>
</div>

<!-- Muestra los datos del registro -->
<div class="alert alert-info mt-4">
    <h5>游늶 Datos del Registro</h5>
    <p class="mb-1"><strong>Estudiante:</strong> {{ object.estudiante }}</p>
    <p class="mb-1"><strong>Materia:</strong> {{ object.materia.nombre }}</p>
    <p class="mb-0"><strong>Fecha:</strong> {{ object.fecha|date:"d \d\e F \d\e Y" }}</p>
</div>

<!-- Muestra errores -->
{% if form.errors %}
    <div class="alert alert-danger mt-3">
        <h5>Por favor, corrige los siguientes errores:</h5>
        <ul>
            {% for field, errors in form.errors.items %}
                <li><strong>{{ field }}:</strong> {{ errors|join:", " }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<form method="post" class="mt-4">
    {% csrf_token %}

    <!-- Campos ocultos para estudiante y materia -->
    <input type="hidden" name="estudiante" value="{{ object.estudiante.id }}">
    <input type="hidden" name="materia" value="{{ object.materia.id }}">

    <!-- Campo "Presente" -->
    <div class="mb-3">
        <div class="form-check form-switch">
            <input class="form-check-input"
                   type="checkbox"
                   role="switch"
                   id="id_presente"
                   name="{{ form.presente.name }}"
                   {% if form.presente.value %}checked{% endif %}>
            <label class="form-check-label" for="id_presente">
                <strong>Presente</strong>
            </label>
        </div>
    </div>

    <!-- Justificaci칩n (solo si est치 ausente) -->
    <div id="justificacion-container" class="mb-4 {% if form.presente.value %}d-none{% endif %}">
        <label for="{{ form.justificacion.id_for_label }}" class="form-label">
            Justificaci칩n (si est치 ausente)
        </label>
        {{ form.justificacion }}
    </div>

    <!-- Botones -->
    <div class="d-flex justify-content-end gap-2">
        <a href="{% url 'asistencia:asistencia_leer' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver a la lista
        </a>
        <button type="submit" class="btn btn-actualizar">
            <i class="fas fa-save"></i> Guardar Cambios
        </button>
    </div>
</form>

<!-- Script para mostrar/ocultar justificaci칩n -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const checkboxPresente = document.getElementById('id_presente');
        const justificacionContainer = document.getElementById('justificacion-container');

        function toggleJustificacion() {
            if (checkboxPresente.checked) {
                justificacionContainer.classList.add('d-none');
            } else {
                justificacionContainer.classList.remove('d-none');
            }
        }

        // Ejecutar al cargar
        toggleJustificacion();

        // Ejecutar cada vez que se cambia el switch
        checkboxPresente.addEventListener('change', toggleJustificacion);
    });
</script>

{% endblock section %}
