{% extends 'inicio/inicio.html' %}
{% load static %}

{% block section %}
<div class="form-container card shadow p-4"> 
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 text-primary">
            <i class="fas fa-calendar-check me-2"></i> Editar Registro de Asistencia
        </h1>
        <a href="{% url 'asistencia:asistencia_leer' %}">
            <button class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
        </a>
    </div>
    <hr class="mb-4">

    <div class="card bg-light border-info mb-4">
        <div class="card-header bg-info text-white fw-bold">Detalles de la Asistencia</div>
        <div class="card-body">
            <p class="mb-2">
                <i class="fas fa-user-graduate me-2"></i> 
                <strong>Estudiante:</strong> {{ object.estudiante.apellido }}, {{ object.estudiante.nombre }}
            </p>
            <p class="mb-2">
                <i class="fas fa-book me-2"></i> 
                <strong>Materia:</strong> {{ object.materia.nombre }} ({{ object.materia.anio }}º Año)
            </p>
            <p class="mb-0">
                <i class="fas fa-calendar-alt me-2"></i> 
                <strong>Fecha:</strong> {{ object.fecha|date:"d/m/Y" }}
            </p>
        </div>
    </div>

    <form method="post" class="styled-form">
        {% csrf_token %}
        
        {% with es_presente=object.presente %}
        <div class="mb-4 p-3 border rounded 
            {% if es_presente %}border-success bg-light-success{% else %}border-danger bg-light-danger{% endif %}"
        >
            <label class="form-label fw-bold d-block mb-2">Estado de la Asistencia:</label>
            <div class="form-check form-switch d-flex align-items-center">
                <input 
                    class="form-check-input me-3" 
                    type="checkbox" 
                    name="presente" 
                    id="id_presente" 
                    role="switch"
                    style="transform: scale(1.5);"
                    value="True" 
                    {% if es_presente %}checked{% endif %}
                >
                <div class="d-inline-block">
                    <span class="fs-5 
                        {% if es_presente %}text-success{% else %}text-danger{% endif %}"
                    >
                        Actualmente: 
                        <strong>
                            {% if es_presente %}PRESENTE{% else %}AUSENTE (FALTA){% endif %}
                        </strong>
                    </span>
                </div>
            </div>
        </div>
        {% endwith %}

        <div class="mb-4">
            <label for="id_justificacion" class="form-label fw-bold">
                <i class="fas fa-pencil-alt me-1"></i> Justificación (Obligatoria si es AUSENTE):
            </label>
            <textarea 
                class="form-control" 
                name="justificacion" 
                id="id_justificacion" 
                rows="3"
                placeholder="Indique el motivo de la ausencia, si aplica."
            >{{ object.justificacion|default_if_none:"" }}</textarea>
            
            {% if form.justificacion.errors %}
                <div class="alert alert-danger mt-2 p-2 small">{{ form.justificacion.errors }}</div>
            {% endif %}
        </div>

        <div class="form-actions pt-3 border-top">
            <button type="submit" class="btn btn-success btn-lg">
                <i class="fas fa-save me-1"></i> Guardar
            </button>
        </div>
    </form>
</div>
{% endblock section %}